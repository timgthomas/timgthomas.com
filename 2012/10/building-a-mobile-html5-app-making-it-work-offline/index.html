<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no,viewport-fit=cover">
  <title>Building a Non-Native Mobile HTML5 App, Part IV: Making It Work Offline · Tim G. Thomas</title>
  <link rel="alternate" href="http://feeds.feedburner.com/timgthomas" title="Tim G. Thomas" type="application/rss+xml">
  <link rel="icon" type="image/x-icon" href="/favicon.png">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Fira+Sans:300,400,500,700,300italic,400italic,500italic,700italic|Fira+Mono">
  <link rel="stylesheet" href="/css/style.css">
<meta name="generator" content="Hexo 5.4.0"></head>
<body>
  <header role="banner">
    <div class="container">
      <h1><a href="/">Tim <em>G</em> Thomas</a></h1>
      <input id="toggle-nav" type="checkbox">
      <nav>
        <a href="/">Blog</a>
        <a href="/projects">Projects</a>
        <a href="/speaking">Speaking</a>
      </nav>
    </div>
  </header>
  <aside>
    <div class="container">
      <p>I apply holistic design principles to make experiences both usable and beautiful.</p>
      <p class="social">
        <a class="social-github" href="https://github.com/timgthomas" target="_blank" rel="noopener">GitHub</a>
        <a class="social-codepen" href="https://codepen.io/TimGThomas" target="_blank" rel="noopener">CodePen</a>
        <a class="social-dribbble" href="https://dribbble.com/timgthomas" target="_blank" rel="noopener">Dribbble</a>
      </p>
    </div>
  </aside>
  <div role="main">
  <article>
    <header>
      <h1>Building a Non-Native Mobile HTML5 App, Part IV: Making It Work Offline</h1>
      <p>11 October 2012</p>
    </header>
    <h2 id="Posts-in-This-Series"><a href="#Posts-in-This-Series" class="headerlink" title="Posts in This Series"></a>Posts in This Series</h2><dl><dt><a href="/2012/09/building-a-mobile-html5-app-going-non-native/">Part I: A Business Case</a></dt><dd>Why our client chose to build a Web app over a native one.</dd><dt><a href="/2012/10/building-a-mobile-html5-app-choosing-a-technology-stack/">Part II: Choosing a Technology Stack</a></dt><dd>How we chose our tools and technologies, and what we picked.</dd><dt><a href="/2012/10/building-a-mobile-html5-app-hooking-things-together/">Part III: Hooking Things Together</a></dt><dd>Wire up a client and server with JavaScript and .NET.</dd><dt>Part IV: Making It Work Offline</dt><dd>Store data locally and synchronize it with a server.</dd><dt><a href="/2012/10/building-a-mobile-html5-app-testing-the-app/">Part V: Testing the App</a></dt><dd>Develop and test for a mobile device.</dd><dt><a href="/2012/11/building-a-mobile-html5-app-making-it-look-native/">Part VI: Making It Look Native</a></dt><dd>Leverage some tricks of Mobile Safari to make a site look like an app.</dd></dl>

<p>In <a href="/2012/10/building-a-mobile-html5-app-hooking-things-together/">part III</a> of this series, we saw how to retrieve a collection of books, via jQuery, from an ASP.NET MVC endpoint. Retrieving data from a server in this manner is great…if you can guarantee your users will always be online. Since we’re discussing how to build a <em>mobile</em> app, however, it’s important to realize users may not always be connected to the Internet. Let’s look at how we can store our list of books offline for use later.</p>
<h2 id="Web-Storage-to-the-Rescue"><a href="#Web-Storage-to-the-Rescue" class="headerlink" title="Web Storage to the Rescue"></a>Web Storage to the Rescue</h2><p>As we discussed in <a href="/2012/10/building-a-mobile-html5-app-choosing-a-technology-stack/">part II</a>, we used a number of HTML5 APIs to make our mobile app work. The one we’ll be looking at today to facilitate storing our book list offline is <code>localStorage</code>.</p>
<p>The <code>localStorage</code> API allows access to an internal-to-the-browser storage area containing key/value pairs of data. While there’s no requirement on storage size, the W3C <a target="_blank" rel="noopener" href="http://dev.w3.org/html5/webstorage/#disk-space">recommends browsers allow at least 5MB per domain</a>. We’ve found iOS devices default to this 5MB limit, but ask the user’s permission to increase this amount if the app approaches the limit.</p>
<p>Currently, a large number of browsers support <code>localStorage</code> (91.67% completely support it, according to <a target="_blank" rel="noopener" href="http://caniuse.com/#search=localStorage">caniuse.com</a>). There are also a number of libraries to help you work with it (including <a target="_blank" rel="noopener" href="http://brian.io/lawnchair/">Lawnchair.js</a> and <a target="_blank" rel="noopener" href="https://github.com/marcuswestin/store.js">Store.js</a>), but, for this post, we’ll stick to using the base API.</p>
<h2 id="Using-the-API"><a href="#Using-the-API" class="headerlink" title="Using the API"></a>Using the API</h2><p>Taking advantage of <code>localStorage</code> is actually quite simple. Supporting browsers expose a JavaScript object, conveniently called <code>localStorage</code>, with which you can interact. Storing a value is quite simple:</p>
<pre><code>localStorage.setItem(&#39;favorite-color&#39;, &#39;#123&#39;);
// &gt; undefined
</code></pre>
<p>…as is retrieving it:</p>
<pre><code>localStorage.getItem(&#39;favorite-color&#39;);
// &gt; &quot;#123&quot;
</code></pre>
<p>We want to store something a little more complicated than a hexadecimal string, though. Unfortunately, <code>localStorage</code> only supports saving strings, so we’ll need to “stringify” our JSON data before we can save it. For this, we’ll use the browser’s <code>JSON</code> object (though, if you’re stuck supporting IE7 or below, you’ll also need Douglas Crockford’s <a target="_blank" rel="noopener" href="https://github.com/douglascrockford/JSON-js">“JSON2” library</a>).</p>
<pre><code>// Our collection of books. This JSON could have come from an AJAX call.
var books = [&#123;&quot;title&quot;:&quot;Myst: The Book of Atrus&quot;,&quot;author&quot;:&quot;Rand Miller&quot;&#125;,&#123;&quot;title&quot;:&quot;The Hobbit&quot;,&quot;author&quot;:&quot;J.R.R. Tolkien&quot;&#125;,&#123;&quot;title&quot;:&quot;Stardust&quot;,&quot;author&quot;:&quot;Neil Gaiman&quot;&#125;];

var stringifiedBooks = JSON.stringify(books);
localStorage.setItem(&#39;books&#39;, stringifiedBooks);
</code></pre>
<p>Consequently, to retrieve our collection, we’ll need to parse the string back into a JSON object.</p>
<pre><code>var stringifiedBooks = localStorage.getItem(&#39;books&#39;);
var books = JSON.parse(stringifiedBooks);
</code></pre>
<p>It’s that easy!</p>
<h2 id="Considerations"><a href="#Considerations" class="headerlink" title="Considerations"></a>Considerations</h2><p>Keep in mind that not <em>quite</em> every browser supports <code>localStorage</code>. Fortunately, we can perform a simple check to avoid any errors and unexpected behaviors:</p>
<pre><code>if (window.localStorage) &#123;
   // work your localStorage magic
&#125; else &#123;
   // er...?
&#125;
</code></pre>
<p>So what <em>do</em> we do when a browser doesn’t support <code>localStorage</code>? The industry’s answer to this question is to use what’s known as a “polyfill”: a third-party library that “fills-in” missing functionality. For our purposes, there are a number of options available, most of which use cookies to simulate this type of persistent storage (and are relatively easy to implement). Mozilla’s <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/DOM/Storage">Developer Network article</a> on <code>localStorage</code> includes two such options (and is, in general, an excellent overview of <code>localStorage</code>).</p>
<p>In this post, we saw how trivially easy it is to store data offline with the <code>localStorage</code> API. Next time, we’ll see some options for debugging mobile apps, <em>just in case</em> some code doesn’t behave the way it should. :)</p>

    <script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "@id": "/2012/10/building-a-mobile-html5-app-making-it-work-offline/",
    "headline": "Building a Non-Native Mobile HTML5 App, Part IV: Making It Work Offline",
    "datePublished": "Thu Oct 11 2012 00:00:00 GMT-0500",
    "image": "http://timgthomas.com/images/headshot.png"
  }
</script>

  </article>
  <nav>
    <span class="post-nav-next">
      
        <a href="/2012/10/building-a-mobile-html5-app-hooking-things-together/">Building a Non-Native Mobile HTML5 App, Part III: Hooking Things Together</a>
      
    </span>
    <span class="post-nav-prev">
      
        <a href="/2012/10/building-a-mobile-html5-app-testing-the-app/">Building a Non-Native Mobile HTML5 App, Part V: Testing the App</a>
      
    </span>
  </nav>
  
  <h2>Comments</h2>
  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.title = 'Building a Non-Native Mobile HTML5 App, Part IV: Making It Work Offline';
      this.page.url = 'http://timgthomas.com/2012/10/building-a-mobile-html5-app-making-it-work-offline/';
      this.page.identifier = '2012/10/building-a-mobile-html5-app-making-it-work-offline/index.html';
    };

    (function() {
      var d = document, s = d.createElement('script');
      s.src = 'https://timgthomas.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>


</div>

  <p id="copyright">&copy; Tim G. Thomas</p>
  
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-49175000-1', 'auto');
  ga('send', 'pageview');
</script>
<script defer data-domain="timgthomas.com" src="https://plausible.io/js/plausible.js"></script>

  
</body>
</html>
